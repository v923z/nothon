<html>
<head>
	<style type="text/css">
textarea.noscrollbars {
  overflow: hidden;
  width: 90%;
  height: 100px;
  resize: none;
  background: #e0e0e0;
}
</style>

</head>
<body>
<script type="text/javascript">
function xml_http_post(url, data, callback) {
    var req = false;
    try {
        // Firefox, Opera 8.0+, Safari
        req = new XMLHttpRequest();
    }
    catch (e) {
        // Internet Explorer
        try {
            req = new ActiveXObject("Msxml2.XMLHTTP");
        }
        catch (e) {
            try {
                req = new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (e) {
                alert("Your browser does not support AJAX!");
                return false;
            }
        }
    }
    req.open("POST", url, true);
    req.onreadystatechange = function() {
        if (req.readyState == 4) {
            callback(req);
        }
    }
    req.send(data);
}

function keypress_event(event) {
	var charCode = event.which || event.keyCode;
	
	if (event.which === 13 && event.shiftKey) {
		alert("here")
		event.returnValue = false
	} 
	//else if (charCode == 42) {
		//event.returnValue = false
	//}
}

function addListener(divide) {
	if (typeof divide.addEventListener != "undefined") {
		divide.addEventListener("keypress", keypress_event, false);
	} else if (typeof divide.attachEvent != "undefined") {
		divide.attachEvent("onkeypress", keypress_event);
	}
}

function new_figure(where_id) {
	var where = document.getElementById(where_id)
	var newDiv = document.createElement("div");
	newDiv.contentEditable = true
	newDiv.innerHTML = '<span style="color:#ff0000";>here</span>'
	document.body.insertBefore(newDiv, where)
	addListener(newDiv)
}

function test_button() {
	var elem = document.getElementById('textarea_code')
	var data = elem.value
	new_figure('code')
    xml_http_post("http://127.0.0.1:8080/", data, test_handle)
}

function test_handle(req) {
	var elem = document.getElementById('codeimg')
	elem.src = "data:image/png;base64," + req.responseText
}

function delay_ms(ms) {
	var date = new Date();
	var curDate = null;
	do { 
		curDate = new Date(); 
	} while(curDate-date < ms);
}

function autoGrow (oField) {
  if (oField.scrollHeight > oField.clientHeight) {
    oField.style.height = oField.scrollHeight + "px";
  }
}

function code_keypress(textArea) {
	var elem = document.getElementById(textArea)
	elem.onkeypress = function(evt) {
		if (evt.which === 13 && evt.shiftKey) {
			alert("here")
			evt.returnValue = false
		}
	}
}

</script>

<input type="button" onClick="test_button();" value="press">

<div id="code" contenteditable="true">Here and there</div>

<textarea id="textarea_code" class="noscrollbars" onkeypress="code_keypress(this);" onkeyup="autoGrow(this);"></textarea>
<div><img id="codeimg" src="./atmega8_pinout.png"  width=50%/></div>
</body>
</html>

